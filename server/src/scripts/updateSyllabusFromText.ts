import { initDatabase } from '../db/database';

const SYLLABUS_TEXT = `
ENGLISH LANGUAGE
TERM
TOPICS
ACTIVITY
REVIEW TEST II
1. Tense- Simple, Continuous, Perfect
2. Informal Letter
3. Adjectives
ANNUAL EXAMINATION
1.Subject verb agreement
2.Adjectives
3.Narrative Essay
4.Story writing
5.Informal letter- revision
Story- writing
No. of students - all
Activity: Each student will create a plot for an interesting story and keep it unfinished for
6.Comprehension- revision
7.Direct and Indirect speech
8.Prepositions - application- revision
9.Tense- Simple, Continuous and Perfect- revision
10.Notice Writing
the next.
Motive:
1. Encouraging children to equally participate in an interactive session.
2. Children will unleash their creativity.
3. Each student will develop their creative, writing, speaking skills.
4. Foster cognitive development.
ENGLISH LITERATURE
TERM
TOPICS
ACTIVITY
REVIEW TEST II
The Lottery Ticket
ANNUAL EXAMINATION
Prose
1) The Remarkable Rocket-Oscar Wilde
2) The Mystery of a Cyber Friend- Zac O' Yeah
Poem
1) Stopping by Woods on a Snowy Evening- Robert Frost
2) To India: My Native Land- Henry Louis Vivian Derozio
Classic Short Story
1) The Lottery Ticket
1) The Lottery Ticket
Development of Creative skills
Work: The class will be divided into groups. Each group will create a mini-skit or mind-map showing the change in the couple’s relationship (Before → During → After the thought that they would win the lottery).
PHYSICS
TERM
TOPICS
ACTIVITY
REVIEW TEST II
Chapter 2 : Physical Quantities and Measurements.
Chapter 5 :Light
ANNUAL EXAMINATION
Chapter 1: Matter
Chapter 2: Physical Quantities and Measurements.
Chapter 3: Force
Chapter 4: Simple Machines
Chapter 5: Light.
Chapter 6: Magnetism.
CHEMISTRY
TERM
TOPICS
ACTIVITY
REVIEW TEST II
Chapter 4: Elements, Compounds, Symbol & Formulae
Chapter 5: Pure Substances and Mixtures; Separation of Mixtures
1. To separate common salt and ammonium chloride by sublimation method.
2. To separate sand from water from a mixture of sand and water by sedimentation and decantation.
3. To separate iron filling from a mixture of iron and sulphur.
4. To demonstrate separation of chalk
powder and water from its mixture using filtration method.
5. To show that air contains oxygen with the help of a candle. (activity 5)
6. To show that air contains carbon dioxide. (activity 6)
7. To show that exhaled air contains CO2 with the help of lime water.
8. To demonstrate that solubility increases on heating.
9. To demonstrate tap water contains soluble impurities.
10 Distillation unit to be demonstrated.
ANNUAL EXAMINATION
Chapters included :
Chapter 3:Matter
Chapter 4: Elements, Compounds, Symbol & Formulae
Chapter 5: Pure Substances and Mixtures; Separation of Mixtures
Chapter 6: Air and Atmosphere
Chapter 7: Water
BIOLOGY
TERM
TOPICS
ACTIVITY
REVIEW TEST II
Second review
Chapter 4: Human Body: Digestive System
1.Study of the human digestive system with the help of a chart and learning about the organs in detail with function.
2. To study the role of diaphragm in breathing.
3. To study the structure of a human heart as a pumping organ through the model of a heart.
4. Students will be asked to make posters about maintaining personal hygiene and how to keep the surroundings clean.
ANNUAL EXAMINATION
1.Chapter2:The Flower
2. Chapter 3: Cell: The structure and functions
3. Chapter 4: Human Body: Digestive System
4. Chapter 5: Human Body: Respiratory System
5. Chapter 6: Human Body: Circulatory System
6. Chapter 7: Disease and Hygiene
7. Chapter 8: Habitat and Adaptation
COMPUTER
TERM
TOPICS
ACTIVITY
REVIEW TEST II
Chapter 2 : File Management: Organisation of Data
Chapter 5 : Presentation: Visual Effects
ANNUAL EXAMINATION
Chapter 2 : File Management: Organisation of Data
Chapter 5 : Presentation: Visual Effects
Chapter 9 : Fundamentals of QBasic : A programming Language (Full chapter) and
Programs using INPUT,IF-THEN,ELSE and ELSEIF statements.
(Notes and programs
based on INPUT, IF-THEN,ELSE and ELSEIF statements will be
given in the class.)
Chapter 7 : HTML: An Introduction
Chapter 6 : Scratch Programming
MATHEMATICS
TERM
TOPICS
ACTIVITY
REVIEW TEST II
1. CHAPTER 8 : RATIO AND PROPORTION
2. CHAPTER 19 : POLYGONS
3. CHAPTER 26 : MEAN AND MEDIAN
ANNUAL EXAMINATION
1. CHAPTER 5 : DECIMAL FRACTIONS
2. CHAPTER 7 : SETS
3. CHAPTER 8: RATIO AND PROPORTION
4. CHAPTER 10: PERCENTAGE
5. CHAPTER 11 : SPEED ,TIME AND DISTANCE
6. CHAPTER 12 : FUNDAMENTAL CONCEPTS OF ALGEBRA
7. CHAPTER 13 : SIMPLE EQUATIONS
8. CHAPTER 17 : QUADRILATERALS
9. CHAPTER 19 : POLYGONS
10. CHAPTER 20: RECOGNITION OF 3D SHAPES (SOLIDS)
11. CHAPTER 22: GEOMETRICAL CONSTRUCTIONS
12. CHAPTER 25: GRAPHICAL REPRESENTATION OF DATA
13. CHAPTER 26 : MEAN AND MEDIAN
GEOGRAPHY
TERM
TOPICS
ACTIVITY
REVIEW TEST II
Chapter 4 - AGRICULTURE
Activity on Agriculture -
ANNUAL EXAMINATION
● Chapter 1: Mapping the Earth
● Chapter 2: Landforms
Activity on minerals -
of the Earth
● Chapter 4: Agriculture
● Chapter 5: Minerals
● Chapter 7:
South America—
Location, Political Divisions and Physical Features
● Map of South America
Map Work -
HISTORY AND CIVICS
TERM
TOPICS
ACTIVITY
REVIEW TEST II
Later Vedic Period
Buddhism and Jainism
ANNUAL EXAMINATION
1. Later Vedic Period
2. Buddhism and Jainism
3. The Rise of Magadha
4. The Mauryan Empire and Administration
5. The Gupta Empire
6. The Early Vedic
Period ( revision)
Civics
7.Rural Local self Government (revision)
8.Urban Local self Government (revision)
2ND LANGUAGE-BENGALI
TERM
TOPICS
ACTIVITY
REVIEW TEST II
2nd Review Test : কে কে লে লে ,পদ পরি রি বর্ত র্ত ন
ANNUAL EXAMINATION
১. ছছোটদে দে র সবুজ পাতা (ষষ্ঠ) : গদ্য – কে কে লে লে , সর্ব র্বনে নে শে শে মাদুলি লি
২. পদ্য – পাছে ছে ললোকে কে কি কি ছু বলে লে
৩. গল্পে ল্পে র রংমশাল – দশরথে থে র পুত্রলাভ, মি মি নুর বাহাদুরি রি ( দ্রুতপঠন )
৪. ভাষা প্রসঙ্গ – সমার্থ র্থক শব্দ, পদ পরি রি বর্ত র্ত ন, পুরুষ, রচনা, পত্ররচনা,
ববোধ পরীক্ষণ
2ND LANGUAGE - HINDI
TERM
TOPICS
ACTIVITY
REVIEW TEST II
मूल्यांकन II : कि कि तनी जमीन, क्रि क्रि या, वि वि लोम (26-35 -भारी- मानव), पर्या र्या र्यायवाची (21-30 कमल – आनंद)।
ANNUAL EXAMINATION
सोन चि चि रैया (6)
गद् य – कि कि तनी जमीन, मि मि ठाईवाला।
पद्य – हम पंक्षी उन्मुक्त गगन के, दोहा दशक ।
व्याकरण ज्ञान - 6
व्याकरण:- क्रि क्रि या, काल (परि रि भाषा भेद तथा उदाहरण) कारक का व्यावहारि रि क अनुप्रयोग, पर्या र्या र्यायवाची शब्द (31-40 कि कि नारा-शरीर), वि वि लोम शब्द (36-50 शूर-सुलभ), अनेक शब्दों के लि लि ए एक शब्द (21-30), समरूपी भि भि न्नार्थ र्थक शब्द – (1-20), मुहावरे (11-20), लोकोक्ति क्ति क्ति याँ (11-20), अपठि ठि त गद् यांश, प्रस्ताव लेखन, पत्र लेखन (औपचारि रि क [वि वि द्यालय से संबंधि धि त] एवं अनौपचारि रि क), नि नि र्दे र्देशानुसार वाक्य – नि नि र्मा र्मा र्माण।
3RD LANGUAGE - HINDI
TERM
TOPICS
ACTIVITY
REVIEW TEST II
मूल्यांकन II : रि रि या का सपना (कहानी), पाठगत व्याकरण |
ANNUAL EXAMINATION
सोन चि चि रैया हि हि ंदी पाठ्य पुस्तक - 3
गद्यः रि रि या का सपना, अनोखा जादू का खेल।
पद्यः चाँद का कुरता l
व्याकरण: पाठगत व्याकरण, अनुच्छेद लेखन, अपठि ठि त गद्यांश, गि गि नती : (२५-५०) अंकों और शब्दों में।
3RD LANGUAGE -BENGALI
TERM
TOPICS
ACTIVITY
REVIEW TEST II
রে রে ফ, বাংলার ছয়টি ঋতু ও বাররোমাসে সে র নাম
ANNUAL EXAMINATION
১. Lets Learn বাংলা : ক ) গদ্য:- বর্ষ র্ষায় দুর্গ র্গতি তি
খ ) পদ্য:- বাবুরাম সাপুড়ে ড়ে
২. ব্যাকরণ :- রে রে ফ, বাংলার ছয় টি ঋতু ও বাররোমাসে সে র নাম
অনুচ্ছে চ্ছে দ লি লি খন :- আমার বি বি দ্যালয়
3RD LANGUAGE -GERMAN
TERM
TOPICS
ACTIVITY
REVIEW TEST II
Lektion 2.1 Was hast du am Montag? ( all Grammar and vocabulary included)
ANNUAL EXAMINATION
Lektion 2.1 Was hast du am Montag?
Lektion 2.2 Was brauchst du heute?
Lektion 2.3 Schon wieder Eintopf ( All Grammar and vocabulary of all the chapters included)
`;

const SUBJECTS = [
    'ENGLISH LANGUAGE',
    'ENGLISH LITERATURE',
    'PHYSICS',
    'CHEMISTRY',
    'BIOLOGY',
    'COMPUTER',
    'MATHEMATICS',
    'GEOGRAPHY',
    'HISTORY AND CIVICS',
    '2ND LANGUAGE-BENGALI',
    '2ND LANGUAGE - HINDI',
    '3RD LANGUAGE - HINDI',
    '3RD LANGUAGE -BENGALI',
    '3RD LANGUAGE -GERMAN'
];

async function updateSyllabus() {
    console.log('Initializing database...');
    const db = await initDatabase();

    // 1. Split text by subjects
    // We need to find the start index of each subject
    const subjectIndices = SUBJECTS.map(subject => {
        const index = SYLLABUS_TEXT.indexOf(subject);
        return { subject, index };
    }).filter(item => item.index !== -1).sort((a, b) => a.index - b.index);

    for (let i = 0; i < subjectIndices.length; i++) {
        const current = subjectIndices[i];
        const next = subjectIndices[i + 1];
        const end = next ? next.index : SYLLABUS_TEXT.length;
        
        const fullSubjectText = SYLLABUS_TEXT.substring(current.index, end);
        
        // 2. Extract ANNUAL EXAMINATION section
        const annualIndex = fullSubjectText.indexOf('ANNUAL EXAMINATION');
        if (annualIndex === -1) {
            console.log(`No ANNUAL EXAMINATION section found for ${current.subject}`);
            continue;
        }

        const annualText = fullSubjectText.substring(annualIndex + 'ANNUAL EXAMINATION'.length).trim();
        
        // 3. Parse Chapters
        const chapters = parseChapters(annualText, current.subject);

        if (chapters.length === 0) {
            console.log(`No chapters parsed for ${current.subject}`);
            continue;
        }

        // 4. Update Database
        console.log(`Updating ${current.subject} with ${chapters.length} chapters...`);
        
        // Find Subject ID
        let subjectRow = await db.get('SELECT id FROM subjects WHERE name = ?', current.subject);
        if (!subjectRow) {
            // Try fuzzy match or create
            subjectRow = await db.get('SELECT id FROM subjects WHERE name LIKE ?', `%${current.subject}%`);
            if (!subjectRow) {
                 const result = await db.run('INSERT INTO subjects (name) VALUES (?)', current.subject);
                 subjectRow = { id: result.lastID };
            }
        }

        // Delete existing chapters for this subject to ensure clean slate for Annual
        await db.run('DELETE FROM chapters WHERE subject_id = ?', subjectRow.id);

        // Insert new chapters
        for (const chapter of chapters) {
            await db.run(
                'INSERT INTO chapters (subject_id, name, syllabus) VALUES (?, ?, ?)',
                subjectRow.id,
                chapter.name,
                chapter.syllabus
            );
        }
    }
    
    console.log('Syllabus update complete.');
}

function parseChapters(text: string, subject: string): { name: string, syllabus: string }[] {
    const lines = text.split('\n').map(l => l.trim()).filter(l => l);
    const chapters: { name: string, syllabus: string }[] = [];
    
    let currentChapter = null;
    let buffer = '';

    // Regex patterns
    const chapterPattern = /^(Chapter\s*\d+|CHAPTER\s*\d+)\s*[:\.]?\s*(.*)/i;
    // Updated to include Bengali digits (\u09E6-\u09EF)
    const numberPattern = /^([0-9\u09E6-\u09EF]+[\.\)]|●)\s+(.*)/; 
    
    // Special handling for English Literature categories
    let currentCategory = '';

    for (const line of lines) {
        // Check for categories in English Literature
        if (subject === 'ENGLISH LITERATURE' && (line === 'Prose' || line === 'Poem' || line === 'Classic Short Story')) {
            currentCategory = line + ': ';
            continue;
        }

        let isNewChapter = false;
        let chapterName = '';
        let chapterContent = line;

        const chapMatch = line.match(chapterPattern);
        const numMatch = line.match(numberPattern);

        if (chapMatch) {
            isNewChapter = true;
            chapterName = chapMatch[1] + (chapMatch[2] ? ': ' + chapMatch[2] : '');
            chapterContent = line;
        } else if (numMatch) {
            isNewChapter = true;
            chapterName = currentCategory + numMatch[2]; // Use the text after number as name
            chapterContent = line;
        } else if (subject.includes('GERMAN') && line.startsWith('Lektion')) {
             isNewChapter = true;
             chapterName = line;
             chapterContent = line;
        }

        if (isNewChapter) {
            // Save previous
            if (currentChapter) {
                currentChapter.syllabus = buffer.trim();
                chapters.push(currentChapter);
            }
            
            // Start new
            currentChapter = {
                name: chapterName.substring(0, 100), // Limit length
                syllabus: ''
            };
            buffer = chapterContent + '\n';
        } else {
            // Append to current
            if (currentChapter) {
                buffer += line + '\n';
            } else {
                // If no chapter started yet, maybe create a "General" one or wait
                // For now, let's start a General one if we encounter text
                currentChapter = { name: 'General / Introduction', syllabus: '' };
                buffer = line + '\n';
            }
        }
    }

    if (currentChapter) {
        currentChapter.syllabus = buffer.trim();
        chapters.push(currentChapter);
    }

    return chapters;
}

updateSyllabus().catch(console.error);
